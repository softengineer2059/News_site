<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}

{% block body %}

	<div class="page-header" style="margin: 5.5rem 1.5rem;">
		<div class="page-leftheader">
			<h4 class="page-title">{{ current_operation }}</h4>
		</div>
	</div>

	{% if form.errors %}
		<div class="alert alert-danger">
			{% for field, errors in form.errors.items %}
				{% for error in errors %}
					{{ error }}<br>
				{% endfor %}
			{% endfor %}
		</div>
	{% endif %}

	<form method="POST" action="{{ request.path }}" enctype="multipart/form-data">
		{% csrf_token %}
		<div class="col-lg-12 col-md-12">
			<div class="card">
				<div class="card-header">
					<h4>{{ status }}</h4>
				</div>
				<div class="card-body pb-2">
					<div class="row row-sm">

						<input class="form-control mb-4" placeholder="Название статьи" type="text" id="{{ form.title.id_for_label }}" name="{{ form.title.name }}">
						{{ form.title.errors }}

						<input class="form-control mb-4" placeholder="Краткое описание" type="text" id="{{ form.short_description.id_for_label }}" name="{{ form.short_description.name }}">
						{{ form.short_description.errors }}

						<input class="form-control mb-4" placeholder="url" type="text" id="{{ form.slug.id_for_label }}" name="{{ form.slug.name }}">
						{{ form.slug.errors }}

						<label class="input-group-btn">Категория</label>
						<div class="col-lg">
							<select class="form-control mb-4" name="{{ form.category.name }}" id="{{ form.category.id_for_label }}"></select>
							{{ form.category.errors }}
						</div>

						<label class="input-group-btn">Подкатегория</label>
						<div class="col-lg">
							<select class="form-control mb-4" name="{{ form.subcategory.name }}" id="{{ form.subcategory.id_for_label }}"></select>
							{{ form.subcategory.errors }}
						</div>

						<label class="input-group-btn">Страна</label>
						<div class="col-lg">
							<select class="form-control mb-4" name="{{ form.country.name }}" id="{{ form.country.id_for_label }}">
								{% for c in country_select %}
									<option value="{{ c.id }}">{{ c.name }}</option>
								{% endfor %}
							</select>
							{{ form.country.errors }}
						</div>

						<label class="input-group-btn">Теги</label>
						<div class="col-lg">
							<select class="form-control mb-4" id="{{ form.tags.id_for_label }}" name="{{ form.tags.name }}" multiple>
								{% for i in tags %}
									<option value="{{ i.id }}">{{ i.name }}</option>
								{% endfor %}
							</select>
							{{ form.tags.errors }}
						</div>

					</div>

					<div class="row row-sm">
						<div class="col-lg">
							<textarea class="form-control mb-4" placeholder="Описание товара" rows="3" id="{{ form.content.id_for_label }}" name="{{ form.content.name }}"></textarea>
							{{ form.content.errors }}
						</div>
					</div>

					<div class="input-group mb-5">
						<input type="text" class="form-control browse-file" placeholder="Поддерживаемые форматы: 'png', 'jpeg', 'jpg'" readonly="">
						<label class="input-group-btn">
							<span class="btn btn-primary">
								Выберите файлы <input id="file-input" name="images" type="file" style="display: none;" multiple="" >
							</span>
						</label>
					</div>
					<div id="file-list" class="mt-3"></div>

					<div class="input-group mb-5">
						<label class="input-group-btn">Опубликовать? {{ form.is_published }}</label>
					</div>
				</div>
			</div>
		</div>
		<div class="btn-group me-2 sw-btn-group-extra" role="group"><button class="btn btn-primary" type="submit">Сохранить</button><a class="btn btn-secondary" href="{% url 'main' %}">Отмена</a></div>
	</form>

	<br>

{% endblock body %}


{% include 'scripts.html' %}

{% block scripts %}
		<script src="{% static '' %}assets/js/article_image_upload.js"></script>

		<script>
			const categorySelect = document.getElementById('{{ form.category.id_for_label }}');
    		const subcategorySelect = document.getElementById('{{ form.subcategory.id_for_label }}');

			categorySelect.innerHTML = '';

			{% for i in category_select %}
				var category_option = document.createElement('option');
				category_option.value = {{ i.id }};
				category_option.text = "{{ i.name }}";
				categorySelect.add(category_option);
			{% endfor %}

			function get_subcategories(){

				const selectedCategoryId = categorySelect.value;
				subcategorySelect.innerHTML = '';

        		{% for key, value in subcategory_select.items %}
            		if (selectedCategoryId == '{{ key }}') {
            			{% for i in value %}
            				var subcategories_option = document.createElement('option')
            				subcategories_option.value = {{ i.id }}{% if not forloop.last %}, {% endif %}
            				subcategories_option.text = "{{ i.name }}"{% if not forloop.last %}, {% endif %}
            				subcategorySelect.add(subcategories_option)
            			{% endfor %} };
        		{% endfor %}
			};

			get_subcategories();

    		categorySelect.addEventListener('change', () =>
    		{
    			get_subcategories();
			});

		</script>

{% endblock scripts %}